<!DOCTYPE html>
<html lang="en">
  <head>
  	<title>Tilt-based Gallery</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <style>
    	/* One day I'll move these into their own file */
    	#log {
  position: absolute;
  color: #fff;
  font-weight: bold;
  z-index: 10000;
}

#images {
  position: relative;
  width: 100%;
  height: 300px;
}
#images > img {
  position: absolute;
  top: 0;
  margin-left: 50%;
  left: -175px;
  max-width: 350px;
  max-height: 263px;
  box-shadow: 0px 3px 17px rgba(0,0,0,0.1);
  height: auto;
  opacity: 0.75;
  -webkit-transition: opacity 250ms;
  transition: opacity 250ms;
}
#images > img.active {
  opacity: 1;
}
#images > img:nth-of-type(1) {
  z-index: 100;
}
#images > img:nth-of-type(2) {
  z-index: 95;
}
#images > img:nth-of-type(3) {
  z-index: 90;
}
#images > img:nth-of-type(4) {
  z-index: 85;
}
#images > img:nth-of-type(5) {
  z-index: 80;
}
#images > img:nth-of-type(6) {
  z-index: 75;
}

.throw-right {
  -webkit-animation: throwRight 4s 1 forwards;
          animation: throwRight 4s 1 forwards;
}

.throw-left {
  -webkit-animation: throwLeft 4s 1 forwards;
          animation: throwLeft 4s 1 forwards;
}

@-webkit-keyframes throwRight {
  from {
    -webkit-transform: translate(0, 0) rotate(0deg);
            transform: translate(0, 0) rotate(0deg);
  }
  to {
    -webkit-transform: translate(6000px, 150px) rotate(1200deg);
            transform: translate(6000px, 150px) rotate(1200deg);
  }
}

@keyframes throwRight {
  from {
    -webkit-transform: translate(0, 0) rotate(0deg);
            transform: translate(0, 0) rotate(0deg);
  }
  to {
    -webkit-transform: translate(6000px, 150px) rotate(1200deg);
            transform: translate(6000px, 150px) rotate(1200deg);
  }
}
@-webkit-keyframes throwLeft {
  from {
    -webkit-transform: translate(0, 0) rotate(0deg);
            transform: translate(0, 0) rotate(0deg);
  }
  to {
    -webkit-transform: translate(-6000px, 150px) rotate(-1200deg);
            transform: translate(-6000px, 150px) rotate(-1200deg);
  }
}
@keyframes throwLeft {
  from {
    -webkit-transform: translate(0, 0) rotate(0deg);
            transform: translate(0, 0) rotate(0deg);
  }
  to {
    -webkit-transform: translate(-6000px, 150px) rotate(-1200deg);
            transform: translate(-6000px, 150px) rotate(-1200deg);
  }
}


		.jumbotron+.jumbotron {
			margin-top: -2rem;
			-webkit-font-smoothing: antialised;
		}

		.jumbotron .blockquote {
			border-left-color: #5bc0de;
		}

		.jumbotron .blockquote .m-b-0 {
			font-size: 1.375rem;
			font-weight: 300;
		}

		.jumbotron .blockquote-footer {
			color: #ececec;
			font-weight: 300;
			font-size: 75%;
		}
    </style>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
	<div class="jumbotron jumbotron-fluid">
		<div class="container">
			<h1 class="display-3">Tilt-based Photo Gallery</h1>
			<p class="lead">Fling to the left or right to throw the picture to the side. Fling back towards yourself to move backwards.</p>
		</div>
	</div>

	<div class="jumbotron jumbotron-fluid bg-primary">
		<div class="container">
			<blockquote class="blockquote">
				<p class="m-b-0 lead">&#128073; Gyroscopes &#128072; &#128588; &#128588; &#128591;</p>
				<footer class="blockquote-footer">Mario <cite title="the Gyroscope Proclamation">overheard outside of a bar deep within the Mushroom Kingdom</cite>, circa 1997</footer>
			</blockquote>
		</div>
	</div>

	<div id="images">
	  <img class="img active" src="https://i.ytimg.com/vi/tntOCGkgt98/maxresdefault.jpg" />
	  <img class="img" src="http://images.thesurge.com/app/uploads/2015/12/cat-.jpg?b87e3b" />
	  <img class="img" src="http://thumb1.shutterstock.com/display_pic_with_logo/139051/302691488/stock-photo-funny-cats-self-picture-selfie-stick-in-his-hand-couple-of-cat-taking-a-selfie-together-with-302691488.jpg" />
	  <img class="img" src="https://i.ytimg.com/vi/MveqXxB12YA/hqdefault.jpg" />
	  <img class="img" src="http://www.tylerdrew.us/wp-content/uploads/2012/03/photo3.jpg" />
	</div>

	<div class="container">
		<h2>Wot u doin m8?</h2>
		<p>
			<em>Tl;dr: We're grabbing the <code>event.rotationRate</code> property from the <code>devicemotion</code> and flinging images to either side depending on whether or not the rates are greater than a certain value.</em>
		</p>

		<pre>
			<code class="javascript">var $images = document.getElementsByClassName('img'),
  cooldown = false,
  active = {},
  bufferX, bufferY;
  
if (/Android/i.test(navigator.userAgent)) {
    bufferX = 2;
    bufferY = 3;
} else if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
    bufferX = 80;
    bufferY = 70;
}</code></pre>
    <p>As always, we start just by setting up some variables that we can access later. Note the difference in buffers between android and iphone. It helps to take a look at some sort of real-time data logger (oh hey, there's one right <a href="../logger/">here</a>) on different devices when trying to determine buffers as the values provided by different devices can vary drastically. In this instance, Android is providing a much lower value than iPhone, which is seemingly more sensitive.</p>
<pre>
<code class="javascript">window.addEventListener("devicemotion", function (event) {
    var rotation  = event.rotationRate;
    
    if (!cooldown) {
    // If the beta axis is greater than our buffer, throw right
      if (rotation.beta > bufferX) {
        throwImage('right');
        getNextImage(1);
      }

      // If the beta axis is less than our buffer, throw left
      if (rotation.beta < -bufferX) {
        throwImage('left');
        getNextImage(1);
      }

      // If the alpha axis is greater than our buffer, retrieve an image
      if (rotation.alpha > bufferY) {
        retrieveImage();
      }
    }
});</code></pre>

        <p>Since we don't need any constants and our functionality is based solely on movement/acceleration rates, we opt in this case for using the <code>devicemotion</code> events <code>event.rotationRate</code> property. It will give us an accurate representation of the acceleration forces being applied to the device in real-time, so we can just toss the axis we want against a simple buffer check to determine whether or not we need to be flinging an image to a direction.</p>

        <pre><code class="javascript">var getNextImage = function(i) {
    if (!active.hasOwnProperty('index')) {
      active.index = 0;
    } else {
      active.index = Math.min(Math.max(active.index + i, 0), $images.length - 1);
    }

    active.img = $images[active.index];
    if (i > 0) {
      active.img.classList.add('active');
    } else {
      active.img.classList.remove('active');
    }
};</code></pre>

<p>From there we can just set up some utility functions to move ourselves through our array of images. Here we're just incrementing the active index and grabbing the correct image for that index.</p>

<pre><code class="javascript">var throwImage = function (direction) {
    active.img.classList.add('throw-'+direction);
    active.img.classList.remove('active');
    cooldown = true;

    window.setTimeout(function() {
      cooldown = false;
    }, 1000);
};</code></pre>

        <p>Whenever we need to throw something in either direction, all we're doing is applying a class that has a CSS3 animation assigned to it. This could be done in JavaScript as well for cooler and more complex effects, however for the purpose of this demo this will suffice.</p>

        <p>Do note however the setting of a timeout to clear our cooldown; this is necessary to prevent us from going through the entire queue in one fling. Since the event fires constantly if we switch to the next index without setting a cooldown up to stop the parsing of events, it'll just keep throwing an image every frame.</p>

<pre><code class="javascript">var retrieveImage = function () {
    getNextImage(-1);
    active.img.classList.remove('throw-right', 'throw-left');
    active.img.classList.add('active');
    cooldown = true;

    window.setTimeout(function() {
      cooldown = false;
    }, 1000);
};</code></pre>

    <p>This is just essentially a step-back utility function that allows the user to traverse through our queue ba ckwards. We set it to grab the last image, then remove the animation classes and toss an active class onto it. Since this is also a queue traversal, we want to set a timeout here as well so the user doesn't accidentally move all the way through the queue due to one movement.</p>

        <h3>Things to note</h3>

        <p>Like I mentioned near the top of the page, different devices report motion data to the browser in very different ways. When it comes to properties such as acceleration you're generally going to see a pretty similar value, however with rotational data on one device you can see rates that are seemingly hypersensitive and on another device you'll find those same rates are far calmer. For example on a Galaxy S5, I was seeing rotational rates closer to 0, with harsh movements peaking at around +/- 5, while on an iPhone 6 the same movements would generate a rotational rate of closer to +/- 100.</p>

        <p>It's also worth noting that for events that need to fire more sequentially, you'll need to implement some sort of throttle so you can limit the actions that occur due to a movement. As I've mentioned, the events fire extremely quickly and without some sort of throttler it would make functionality like we're achieving here extremely difficult (if not unusable) for the end user.</p>

		<nav>
        <p><a href="../../index.html">&laquo; Go back to the main page</a></p>

		<h2>Other Examples</h2>
	  		<ul class="nav nav-pills nav-stacked">
	  			<li class="nav-item">
	  				<a href="../logger/" class="nav-link">Gyroscope Data Logger</a>
	  			</li>
	  			<li class="nav-item">
	  				<a href="../scrolling/" class="nav-link">Tilt-Based Page Scrolling</a>
	  			</li>
	  			<li class="nav-item">
	  				<a href="../photogallery/" class="nav-link">Throw-away Photo Gallery</a>
	  			</li>
	  		</ul>
	  	</nav>
  	</div>

  	<div id="controller">
	  <button id="toggleScrolling" value="false">
	    Gyroscope On
	  </button>
	  <button id="resetOrigin">
	    Reset Origin
	  </button>
	</div>

    <script src="../photogallery.js"></script>
  </body>
</html>